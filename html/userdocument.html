<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--通用样式-->
		<link rel="stylesheet" / href="../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../css/icons-extra.css" />
		<link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/question-list.css" />
		<link rel="stylesheet" / href="../css/jinhu.css">
	</head>
	<style>
		.starCon span{
			padding-right: 0px !important;
			margin-left: 0px !important;
			margin-right: 0px !important;
		}
		.text-muted-left{
			padding-left: 17px;
			padding-right: 7px;
			padding-bottom: 10px;
		}
		.document-list .mui-content-padded p{
	font-size: 16px;
	word-wrap: break-word;
	word-break:break-all;
	margin-bottom: 5px;   
}
.document-list .mui-content-padded span{
    padding-left: 3px;
    padding-right: 3px;
 	margin-left: 8px;
	border-radius: 3px; 
	font-size: 11px;
}
.document-list .mui-content-padded .label{
	font-size: 12px;
	height: 20px;
	white-space: inherit;
}
		#icon{
			display: inline-block !important;
    		font-size: 16px !important;
    		padding-left: 0px !important;
    		margin-left: 0px !important;
    		position: absolute;
			position: absolute;
		}
		.status{
			display: inline-block;
			vertical-align: top;
			padding-left: 0.7rem !important;
			margin-top: 3px;
			margin-bottom: 7px;
		}
		.status span{
			display: inline-block;
			margin-right: 0.2rem;
		}
		.status span:first-child{
			margin-left: -19px !important;
		}
		.subject{
			padding: 10px 10px 0px 15px;
    		position: relative;
    		word-break: break-all;
    		font-size: 16px;
    		line-height: 16px;
		}
		.mui-row{
			margin-left: -4px;
			margin-right: -5px;
			margin-top: -4px;
			margin-bottom: 0px;
		}
		
		.text-muted {
		    padding-left: 16px;
		    padding-right: 5px;
		    font-size: 12px;
		    padding-top: 5px;
		    padding-bottom: 10px;
		}
		.content{
			word-wrap: break-word;
			display: inline-block;
			margin-right: 0.4rem;
			margin-left: 1.2rem;
		}
		.mui-bar~.mui-content .mui-fullscreen {
			top: 44px;
			height: auto;
		}		
		.mui-pull-top-tips {
			position: absolute;
			top: -20px;
			left: 50%;
			margin-left: -25px;
			width: 40px;
			height: 40px;
			border-radius: 100%;
			z-index: 1;
		}
		
		.mui-bar~.mui-pull-top-tips {
			top: 24px;
		}		
		.mui-pull-top-wrapper {
			width: 42px;
			height: 42px;
			display: block;
			text-align: center;
			background-color: #efeff4;
			border: 1px solid #ddd;
			border-radius: 25px;
			background-clip: padding-box;
			box-shadow: 0 4px 10px #bbb;
			overflow: hidden;
		}		
		.mui-pull-top-tips.mui-transitioning {
			-webkit-transition-duration: 200ms;
			transition-duration: 200ms;
		}		
		.mui-pull-top-tips .mui-pull-loading {
			margin: 0;
		}		
		.mui-pull-top-wrapper .mui-icon,
		.mui-pull-top-wrapper .mui-spinner {
			margin-top: 7px;
		}		
		.mui-pull-top-wrapper .mui-icon.mui-reverse {
		}		
		.mui-pull-bottom-tips {
			text-align: center;
			background-color: #efeff4;
			font-size: 15px;
			line-height: 40px;
			color: #777;
		}		
		.mui-pull-top-canvas {
			overflow: hidden;
			background-color: #fafafa;
			border-radius: 40px;
			box-shadow: 0 4px 10px #bbb;
			width: 40px;
			height: 40px;
			margin: 0 auto;
		}		
		.mui-pull-top-canvas canvas {
			width: 40px;
		}		
		.mui-slider-indicator.mui-segmented-control {
			background-color: #efeff4;
		}		
		.jh-orange {
			color: #FF9900;
		}		
		.typeitem {
			text-align: center;
			border: 1px solid #BCBCBC;
			height: 35px;
			padding-top: 5px;
			padding-right: 10px;
		}						
		.jh-title {
			float: left;
		}
		.mui-scroll{
			min-height: 100%;
		}
		.document-list{
			border-bottom: 1px solid #e4e4e4;
		}
		.popover-item{
			padding:13px 15px;border-radius:0;color:#000000
		}
		.text-muted li:nth-last-of-type(2){
			float: inherit;
			margin-left: 15px;
		}
	</style>
	<body style="background-color: #FFFFFF;">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left" style="color:#333333">
				<span class="mui-icon mui-icon-left-nav"></span><span id="navtil"></span>
			</a>
			<span class="mui-pull-right" id="creatdocument" style="display: none;">
				<i class="fa fa-plus" style="font-size: 23px;line-height: 50px;padding-right: 4px;" aria-hidden="true"></i>
			</span>
		</header>
		<div class="mui-content" id="contentArea" style="display: block">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted jh-scroll-wrapper">
					<div class="mui-scroll" id="SectionType" style="padding-right: 40px;padding-left: 0.7rem;">
						<a class="mui-control-item mui-active" href="#itemmobile" id="0"style="padding-left: 4px;">
							上传的文档
						</a>
						<a class="mui-control-item" href="#item0mobile" id="1">
							下载的文档
						</a>
						<a class="mui-control-item" href="#item1mobile" id="2">
							收藏的文档
						</a>
						
					</div>
				</div>
				<div class="mui-slider-group" id="sliderGroup"style="top: 40px;">
					<div id="itemmobile" class="mui-slider-item mui-control-content mui-active">
						<div class="mui-scroll-wrapper" id="refreshContainer">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<div class="mui-loading">
										<div class="mui-spinner">
										</div>
									</div>
								</ul>
							</div>
						</div>
					</div>
					<div id="item0mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper"id="refreshContainer1">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<div class="mui-loading">
										<div class="mui-spinner">
										</div>
									</div>
								</ul>
							</div>
						</div>
					</div>
					<div id="item1mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper"id="refreshContainer2">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<div class="mui-loading">
										<div class="mui-spinner">
										</div>
									</div>
								</ul>
							</div>
						</div>
					</div>					
				</div>
			</div>
			<script src="../js/mui.min.js"></script>
			<script src="../js/crypto-js.js"></script>
			<script src="../js/mui.pullToRefresh.js"></script>
			<script src="../js/mui.pullToRefresh.material.js"></script>
			<script src="../js/service.js"></script>
			<script src="../js/common.js"></script>
			<script src="../js/attachment.js"></script>
			<script src="../js/wxHelper.js"></script>
	</body>
	<script type="text/javascript">
		var userId = 0;
		var username="";
		var creatdocument = document.getElementById("creatdocument");
		window.onload = function() { 
			//获取url中的targetId参数                                                                                                           
			if(mui.os.plus) {
				mui.plusReady(function() {
					var self = plus.webview.currentWebview();
					userId = self.userId;
					username=self.username;
					uploadedDocument(false)
					username=(username=="me")?"我":username
					creatdocument.style.display=(username=="我")?'block':'none';					
					document.getElementById("navtil").innerHTML=username+'的文档';
					//关闭等待框                                                                                                               
					plus.nativeUI.closeWaiting();
					//显示当前页面                                                                                                              
					mui.currentWebview.show();
				});
			} else {
				userId = getUrlParam('userId');
				username=getUrlParam('username');
				uploadedDocument(false)
			}
			username=(username=="me")?"我":username
			creatdocument.style.display=(username=="我")?'block':'none';
			document.getElementById("navtil").innerHTML=username+'的文档';
		}
		creatdocument.addEventListener('tap',function(){
				mui.openWindow({
					url: 'creatDoc.html',
					id: 'creatDoc.html',
					show:{
				      autoShow:false
				   },
					waiting: {
						options: {
							loading: {
								height: '35px'
							}
						}
					}
				})
			})
		var ids = [];				
		function login (){
			if(mui.os.wechat){
				getCode('',true)
			}else{
				mui.openWindow({
				url: 'user_login.html',
				id: 'user_login.html',
				waiting: {
					options: {
						loading: {
							height: '35px'
						}
					}
				}
			})	
			}			
		}
		mui.init( { gestureConfig:{
		   tap: true, //默认为true
		   longtap: true, //默认为false
		}})
		function creatfavPop() {
			var div = document.createElement('div');
			div.id = 'favpopover';
			div.style.display = "none"
			div.className = 'box mui-popover mui-popover-action mui-popover-bottom';
			div.innerHTML =' <ul class="mui-table-view popover-all" style="margin:0px;border-radius:0">'+
			    '<li class="mui-table-view-cell popover-item" id="fav"><a href="#">取消收藏</a></li>'+
			    '<li style="height:10px;background-color: rgba(0,0,0,.2);"></li>'+
			    '<li class="mui-table-view-cell popover-item"id="favqu"><a href="#">取消</a></li>'+
			    '</ul>';
			bigContainer.appendChild(div);
		}
    	creatfavPop(); 
    	var documentFavId;
    	var fav = document.getElementById("fav");
		fav.addEventListener("tap",function(e){
			var content = document.getElementById("refreshContainer2").getElementsByTagName("ul")[0];
			content.innerHTML = "";
			DocumentFavoriteOperation(documentFavId)
			mui('#favpopover').popover('toggle');						
			mui('#refreshContainer2').scroll().scrollTo(0,0);
		})
		var favqu = document.getElementById("favqu")
			favqu.addEventListener("tap",function(e){						
			mui('#favpopover').popover('hide');
		})
    	mui("#item1mobile").on('longtap', '.favoritedocumentlongtap', function(e) {
			mui('#favpopover').popover('toggle');//floatWebview();																									
			documentFavId = this.getAttribute("id");					
		})
    	function DocumentFavoriteOperation(id) {
    		var path = 'Document/DocumentHandle?documentId='+id+'&method=favorite';
			var waiting = showWaiting();			
			postDatawithToken(path, {}, function(data) {
				closeWaiting(waiting);					
				if(data.Type == 1) {
					mui.toast("取消收藏成功")	
					favoriteDocument(false)
					mui('#refreshContainer').scroll().scrollTo(0,0);
				} else if(data.Type == 0) {
					//登录失败
					mui.toast("请登录后再进行操作");
					login();
					return;
				} else {
					//逻辑错误
					mui.toast(data.Data);
					return;
				}
			}, function(err) {
				closeWaiting(waiting);
			})
		}
    	function creatuploadPop() {
			var div = document.createElement('div');
			div.id = 'uploadpopover';
			div.style.display = "none"
			div.className = 'box mui-popover mui-popover-action mui-popover-bottom';
			div.innerHTML =' <ul class="mui-table-view popover-all" style="margin:0px;border-radius:0">'+
			    '<li class="mui-table-view-cell popover-item" id="uploaddelete"><a href="#">删除</a></li>'+
			    '<li style="height:10px;background-color: rgba(0,0,0,.2);"></li>'+
			    '<li class="mui-table-view-cell popover-item"id="uploadqu"><a href="#">取消</a></li>'+
			    '</ul>';
			bigContainer.appendChild(div);
		}
    	creatuploadPop();
    	var documentDelId;
    	var uploaddelete = document.getElementById("uploaddelete");
		uploaddelete.addEventListener("tap",function(e){
			var content = document.getElementById("refreshContainer").getElementsByTagName("ul")[0];
			content.innerHTML = "";
			deleteDocument(documentDelId)
			mui('#uploadpopover').popover('toggle');												
			mui('#refreshContainer1').scroll().scrollTo(0,0);
		})
		var uploadqu = document.getElementById("uploadqu")
		uploadqu.addEventListener("tap",function(e){
			mui('#uploadpopover').popover('hide');
		})
    	mui("#itemmobile").on('longtap', '.uploadeddocumentlongtap', function(e) {
			mui('#uploadpopover').popover('toggle');//floatWebview();																									
			documentDelId = this.getAttribute("id");					
		})
    	function deleteDocument(id) {
    		var path = 'Document/DeleteDocument?documentId='+id;
			var params = {
				documentId : id
			}
			postDatawithToken(path,{}, function(data) {	
				if(data.Type == 1) {
					mui.toast("删除成功")
					uploadedDocument(false)
					mui('#refreshContainer').scroll().scrollTo(0,0);
				} else if(data.Type == 0) {
					//登录失败
					mui.toast("请登录后再进行操作");
					login();
					return;
				} else {
					//逻辑错误
					mui.toast(data.Data);
					return;
				}
			}, function(err) {
			})
		}
		var selel = document.getElementsByClassName("mui-control-item mui-active");
		mui('.mui-slider').slider();
		var deceleration = mui.os.ios ? 0.003 : 0.0009;
		mui('.mui-scroll-wrapper.mui-slider-indicator.mui-segmented-control').scroll({
			scrollY: false,
			scrollX: true,
			indicators: false,
			deceleration: deceleration,
			snap: '.mui-control-item'
		});
		var tabIndex = 0;
		document.querySelector('.mui-slider').addEventListener('slide', function(event) {
			tabIndex = event.detail.slideNumber;
			if(event.detail.slideNumber != 0) {
				var index = event.detail.slideNumber - 1;
				var item = document.getElementById("item" + index + "mobile");
				item.querySelector('.mui-pull-bottom-tips').style.display = 'none';
				if(item.querySelector('.mui-loading')) {
					if(index == 1) {
						favoriteDocument(false)
					}
					if(index == 0) {
						downloadDocument(false)
					}
				}
			}
		});
		var pageindex = 1;
		(function($) {
			//阻尼系数
			var deceleration = mui.os.ios ? 0.003 : 0.0009;
			$('.mui-scroll-wrapper').scroll({
				bounce: false,
				indicators: true, //是否显示滚动条
				deceleration: deceleration
			});
			$.ready(function() {
				//循环初始化所有下拉刷新，上拉加载。
				$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
					$(pullRefreshEl).pullToRefresh({
						down: {
							callback: function() {
								var self = this;
								document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'none';
								if(selel[0].id == '1') {
									downloadDocument(false)
								}
								if(selel[0].id == '0') {
									uploadedDocument(false)
								}
								if(selel[0].id == '2') {
									favoriteDocument(false)
								}
								setTimeout(function() {
									self.endPullDownToRefresh();
								}, 1000);
							}
						},
						up: {
							show: false,
							callback: function() {
								var self = this;
								if(selel[0].id == '0') {
									uploadedDocument(true)
								}
								if(selel[0].id == '1') {
									downloadDocument(true)
								}
								if(selel[0].id == '2') {
									favoriteDocument(true)
								}
								setTimeout(function() {
									self.endPullUpToRefresh();
								}, 1000);
							}
						}
					});
				});
			});
		})(mui);
			mui("#itemmobile").on('tap', '.uploadeddocumenttap', function(e) {
				var documentId = this.getAttribute('id');
				var mediaType = Number(this.getAttribute('title'));
				var baseUrl = 'documentDetail.html';
				switch (mediaType){
					case 1:
						baseUrl = 'docImgsDetail.html';
						break;
					case 2:
						baseUrl = 'docVideoDetail.html';
						break;
					default:
						baseUrl = 'documentDetail.html'
						break;
				}
					var url = mui.os.plus ? baseUrl : baseUrl + '?documentId=' + documentId;
					var curl = shareUrl+ baseUrl+ '?documentId=' + documentId;
					setlsData('currUrl', curl);
					mui.openWindow({
						url: url,
						id: baseUrl,
						show: {
							autoShow: true
						},
						waiting: {
							options: {
								loading: {
									height: '35px'
								}
							}
						},
						extras: {
							documentId: documentId,
							tabIndex: tabIndex,
							type: 'user',
							currId: 'userdocument.html'
						}
					})
			});
			mui("#item0mobile").on('tap', '.downloaddocumenttap', function(e) {
				var documentId = this.getAttribute('id');
				var mediaType = Number(this.getAttribute('title'));
				var baseUrl = 'documentDetail.html';
				switch (mediaType){
					case 1:
						baseUrl = 'docImgsDetail.html';
						break;
					case 2:
						baseUrl = 'docVideoDetail.html';
						break;
					default:
						baseUrl = 'documentDetail.html'
						break;
				}
					var url = mui.os.plus ? baseUrl : baseUrl + '?documentId=' + documentId;
					var curl = shareUrl+ baseUrl+ '?documentId=' + documentId;
					setlsData('currUrl', curl);
					mui.openWindow({
						url: url,
						id: baseUrl,
						show: {
							autoShow: true
						},
						waiting: {
							options: {
								loading: {
									height: '35px'
								}
							}
						},
						extras: {
							documentId: documentId,
							tabIndex: tabIndex,
							type: 'user',
							currId: 'userdocument.html'
						}
					})
			}),
			mui("#item1mobile").on('tap', '.favoritedocumenttap', function(e) {
				var documentId = this.getAttribute('id');
					var mediaType = Number(this.getAttribute('title'));
					var baseUrl = 'documentDetail.html';
					switch (mediaType){
						case 1:
							baseUrl = 'docImgsDetail.html';
							break;
						case 2:
							baseUrl = 'docVideoDetail.html';
							break;
						default:
							baseUrl = 'documentDetail.html'
							break;
					}
					var url = mui.os.plus ? baseUrl : baseUrl + '?documentId=' + documentId;
					var curl = shareUrl+ baseUrl+ '?documentId=' + documentId;
					setlsData('currUrl', curl);
					mui.openWindow({
						url: url,
						id: baseUrl,
						show: {
							autoShow: true
						},
						waiting: {
							options: {
								loading: {
									height: '35px'
								}
							}
						},
						extras: {
							documentId: documentId,
							tabIndex: tabIndex,
							type: 'user',
							currId: 'userdocument.html'
						}
					})
			})
		var creatuploadedDocumentElement = function(data, id,more) {			
			var fragment = document.getElementById(id);
			var cfragment = fragment.firstElementChild;
			var finel = cfragment.firstElementChild.querySelector('.mui-table-view');
			var fragment = document.createDocumentFragment();
			var newFragment = document.createDocumentFragment();
			var Essential;
			var a1 = [];
			var li;
			var bigContainer;
			for(var i = 0; i < data.length; i++) {				
				var icon = getDocumentType(data[i].Extension);
				switch(data[i].ApprovalStatus){
					case 20 :
						var ApprovalStatus = '<li style="color: #FF9900;padding-right:0.5rem;">' + "待审核" + '</li>';
					break;
					case 30:
						var ApprovalStatus = '<li style="color: #FF9900;padding-right:0.5rem;">' + "需再审核" + '</li>';
					break;
					case 10:
						var ApprovalStatus = '<li style="color: #FF0000;padding-right:0.5rem;">' + "审核未通过" + '</li>';
					break;
					case 40:
						//var ApprovalStatus = '<li style="color: #008000;padding-right:0.5rem;">' + "审核通过" + '</li>'
						var ApprovalStatus = ''
					break;
					default:
						ApprovalStatus=''
					break;
				}
				span = document.createElement('span');
				var resolved = "";				
				var dis = 'none';
				bigContainer = "";
				a1 = [];
				if(data[i].IsEssential) {
					Essential = '<span class="jh-red-border">' + "精华" + '</span>'
				} else {
					Essential = ''
				}
				if(data[i].IsSticky) {
					Sticky = '<span class="jh-red-border">' + "置顶" + '</span>'
				} else {
					Sticky = ''
				}
				if(Essential== '' && Sticky == ''){
					var dis = "none";
				}else{
					var dis = "inline-block";
				}
				for(var r = 0; r < a1.length; r++) {
					bigContainers = "";
					itemContainer = '<a  class="tagname" id=' + a1[r] + '><span class="label label-default">' + a1[r] + '</span></a>'
					bigContainer += itemContainer;
				}
				var shenglue = data[i].Subject.length > 15 ? "..." : "";//.substring(0, 15) +shenglue
				div = document.createElement('div');
				div.className = 'mui-content document-list';
				div.id = data[i].Id; 
				div.title=data[i].MediaType;
				div.innerHTML = 
					'<div class="mui-content-padded uploadeddocumenttap uploadeddocumentlongtap" id=' + data[i].Id + ' title='+data[i].MediaType+'>' +
					'<div class="subject">'+
					icon+
					'                                              <p class="content" id=' + data[i].Id + '>' + 
					data[i].Subject+
					
					'                                              </p>'+
					'<span class="status" style="display:'+ dis +'">'+
					Sticky +
					Essential +
					'</span>'+
					'</div>' +
					'                                              <div class="mui-row"> ' +
					
					'                                              <ul class="mui-list-inline text-muted" >' +
					'                                              <li>' + data[i].DownloadCount + '次下载' + '</li>' +
					'                                              <li style="float:left;padding-top:2px;margin-left:0px !important;">' + data[i].FriendlyFileLength + '</li>' +
					ApprovalStatus+
					
					'                                              </ul>' +
					'                                              </div>' +
					'                                              </div>' +
					'                                              </div>';
				if(more == true){
					finel.appendChild(div);
				}else{
					newFragment.appendChild(div);
				}
			}
			if(more == false){
				finel.innerHTML=nodeToString(newFragment);
			}
		};
		var creatdownloadDocumentElement = function(data, id,more) {			
			var fragment = document.getElementById(id);
			var cfragment = fragment.firstElementChild;
			var finel = cfragment.firstElementChild.querySelector('.mui-table-view');
			var fragment = document.createDocumentFragment();
			var newFragment = document.createDocumentFragment();
			var Essential;
			var a1 = [];
			var li;
			var bigContainer;
			for(var i = 0; i < data.length; i++) {
				var star = "";
			var stars = "";
			var starskong = "";
			var starHalf ="";
			function isInteger(obj) {
				return Math.floor(obj) === obj;
			}
			
			if(isInteger(data[i].StarReview) == false){
				var newNum=data[i].StarReview.toString().replace(/\d+\.(\d*)/,"$1");
				var newLength = newNum < 5 ? (data[i].StarReview - 1) : data[i].StarReview ;
				var newLengths = data[i].StarReview + 1;
				starHalf = newNum < 5 ? '<span class="fa fa-star-half-o tn-orange-color"></span>' : '';
			}else{
				var newLength = data[i].StarReview;
				var newLengths = data[i].StarReview;
			}
			for(var n = 0;n<newLength;n++){
				var starlist = '<span class="fa fa-star tn-orange-color"></span>';
				stars += starlist;
			}
			for(var m = 0;m<5 - newLengths;m++){
				var starkonglist = '<span class="fa fa-star-o"></span>';
				starskong += starkonglist;
			}
			star = stars + starHalf + starskong;
			var starCon = '<li class="starCon" style="float:right;padding-right:0.7rem;">' + star + '<li>';
				var icon = getDocumentType(data[i].Extension);			
				span = document.createElement('span');				
				var dis = 'none';
				bigContainer = "";
				a1 = [];
				Essential = data[i].IsEssential == true ? '<span class="jh-red-border">' + "精华" + '</span>' : '';
				Sticky = data[i].IsSticky == true ? '<span class="jh-red-border">' + "置顶" + '</span>' : '';
				if(Essential== '' && Sticky == ''){
					var dis = "none";
				}else{
					var dis = "inline-block";
				}
				for(var r = 0; r < a1.length; r++) {
					bigContainers = "";
					itemContainer = '<a  class="tagname" id=' + a1[r] + '><span class="label label-default">' + a1[r] + '</span></a>'
					bigContainer += itemContainer;
				}
				var shenglue = data[i].Subject.length > 15 ? "..." : "";//.substring(0, 15) +shenglue
				div = document.createElement('div');
				div.className = 'mui-content document-list';
				div.id = data[i].Id;
				div.title=data[i].MediaType;
				div.innerHTML = 
					'<div class="mui-content-padded downloaddocumenttap downloaddocumentlongtap" id=' + data[i].Id + ' title='+data[i].MediaType+'>' +
					'<div class="subject">'+
					icon+
					'                                              <p class="content" id=' + data[i].Id + '>' + 
					data[i].Subject+
					
					'                                              </p>'+
					'<span class="status" style="display:'+ dis +'">'+
					Sticky +
					Essential +
					'</span>'+
					'</div>' +
					'                                              <div class="mui-row"> ' +
					
					'                                              <ul class="mui-list-inline text-muted-left" >' +										
					'                                              <li style="padding-right:0.5rem;">' + data[i].FriendlyFileLength + '</li>' +
					'                                              <li>' + data[i].DownloadCount + '次下载' + '</li>' +
					starCon+
					'                                              </ul>' +
					'                                              </div>' +
					'                                              </div>' +
					'                                              </div>';  
				if(more == true){
					finel.appendChild(div);
				}else{
					newFragment.appendChild(div);
				}
			}
			if(more == false){
				finel.innerHTML=nodeToString(newFragment);
			}
		};
		var creatfavoritedocumentElement = function(data, id,more) {			
			var fragment = document.getElementById(id);
			var cfragment = fragment.firstElementChild;
			var finel = cfragment.firstElementChild.querySelector('.mui-table-view');
			var fragment = document.createDocumentFragment();
			var newFragment = document.createDocumentFragment();
			var Essential;
			var a1 = [];
			var li;
			var bigContainer;
			for(var i = 0; i < data.length; i++) {
				var star = "";
				var stars = "";
				var starskong = "";
				var starHalf ="";
				function isInteger(obj) {
				return Math.floor(obj) === obj;
			}
				if(isInteger(data[i].StarReview) == false){
				var newNum=data[i].StarReview.toString().replace(/\d+\.(\d*)/,"$1");
				var newLength = newNum < 5 ? (data[i].StarReview - 1) : data[i].StarReview ;
				var newLengths = data[i].StarReview + 1;
				starHalf = newNum < 5 ? '<span class="fa fa-star-half-o tn-orange-color"></span>' : '';
			}else{
				var newLength = data[i].StarReview;
				var newLengths = data[i].StarReview;
			}
			for(var n = 0;n<newLength;n++){
				var starlist = '<span class="fa fa-star tn-orange-color"></span>';
				stars += starlist;
			}
			for(var m = 0;m<5 - newLengths;m++){
				var starkonglist = '<span class="fa fa-star-o"></span>';
				starskong += starkonglist;
			}
			star = stars + starHalf + starskong;
				var starCon = '<li class="starCon" style="float:right;padding-right:0.7rem;">' + star + '<li>';
				var icon = getDocumentType(data[i].Extension);	
				span = document.createElement('span');				
				var dis = 'none';
				bigContainer = "";
				a1 = [];
				var Author;
				Author = data[i].IsAnonymous ? '<li>' + "匿名用户 " + '</li>' : '<li>' + data[i].Author + '</li>';
				Essential = data[i].IsEssential == true ? '<span class="jh-red-border">' + "精华" + '</span>' : '';
				Sticky = data[i].IsSticky == true ? '<span class="jh-red-border">' + "置顶" + '</span>' : '';
				if(Essential== '' && Sticky == ''){
					var dis = "none";
				}else{
					var dis = "inline-block";
				}
				for(var r = 0; r < a1.length; r++) {
					bigContainers = "";
					itemContainer = '<a  class="tagname" id=' + a1[r] + '><span class="label label-default">' + a1[r] + '</span></a>'
					bigContainer += itemContainer;
				}
				var shenglue = data[i].Subject.length > 15 ? "..." : "";//.substring(0, 15) +shenglue
				div = document.createElement('div');
				div.className = 'mui-content document-list';
				div.id = data[i].Id;
				div.title=data[i].MediaType;
				div.innerHTML = 
					'<div class="mui-content-padded favoritedocumenttap favoritedocumentlongtap" id=' + data[i].Id + ' title='+data[i].MediaType+'>' +
					'<div class="subject">'+
					icon+
					'                                              <p class="content" id=' + data[i].Id + '>' + 
					data[i].Subject+
					
					'                                              </p>'+
					'<span class="status" style="display:'+ dis +'">'+
					Sticky +
					Essential +
					'</span>'+
					'</div>' +
					'                                              <div class="mui-row"> ' +
					
					'                                              <ul class="mui-list-inline text-muted-left" >' +										
					'                                              <li style="padding-right:0.5rem;">' + data[i].FriendlyFileLength + '</li>' +
					'                                              <li>' + data[i].DownloadCount + '次下载' + '</li>' +
					starCon+
					'                                              </ul>' +
					'                                              </div>' +
					'                                              </div>' +
					'                                              </div>'; 
				if(more == true){
					finel.appendChild(div);
				}else{
					newFragment.appendChild(div);
				}
			}
			if(more == false){
				finel.innerHTML=nodeToString(newFragment);
			}
		};
		var page = 1;
		var idName = "";
		var bool;		
		function uploadedDocument(more) {
//			if(!more) {
//				showLoading('', '', '#FFFFFF', '90px', '1');
//			}
			idName = selel[0].href.substring(selel[0].href.lastIndexOf("#") + 1, selel[0].href.length);
			var fragment = document.getElementById(idName);
			var cfragment = fragment.firstElementChild;
			var finel = cfragment.firstElementChild.querySelector('.mui-table-view');
			if(finel.querySelector('.mui-loading')) {
				finel.removeChild(finel.childNodes[1]);
			}
			if(more) {
				page++;
			} else {
				//finel.innerHTML = '';
				page = 1;
			}			
			var params = {
				userId : userId,
				method : "upload",
				pageSize: 10,
				pageIndex: page,
			};
			getDatawithToken('Document/GetUserDocuments', params, function(data) {
				hideLoading()
				var bottomTip = document.querySelectorAll('.mui-pull-bottom-tips');
				if(data.Type == 1) {
					console.log(data)
					if(data.Data && typeof(data.Data) == 'object') {
						hideErrForList('',idName);
						if(data.Data.length <= 10) {
							document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'none';
						} else {							
							document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'block';
						}
						creatuploadedDocumentElement(data.Data, idName,more);
					} else {
						document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'none';						
						if(!more){
							var errForList=showErrForList(data.Data,'','',idName);
							if(errForList){
								fragment.appendChild(showErrForList(data.Data,'','',idName))
							}
						}
						if(data.Data!='暂无更多文档'){
							mui.toast(data.Data);
						}
					}
				} else if(data.Type == 0) {
					//登录失败
					mui.toast("请登录后再进行操作");
					login();
					return;
				} else {
					//逻辑错误
					var errForList=showErrForList(data.Data,'','',idName);
					if(errForList){
						fragment.appendChild(showErrForList(data.Data,'','',idName))
					}
					mui.toast(data.Data);
					return;
				}
			}, function(err) {
				setErr('','90px')
			})
		}
		function downloadDocument(more) {
//			if(!more) {
//				showLoading('', '', '#FFFFFF', '90px', '1');
//			}
			idName = selel[0].href.substring(selel[0].href.lastIndexOf("#") + 1, selel[0].href.length);
			var fragment = document.getElementById(idName);
			var cfragment = document.getElementById("refreshContainer1");
			var finel = cfragment.firstElementChild.querySelector('.mui-table-view');
			if(finel.querySelector('.mui-loading')) {
				finel.removeChild(finel.childNodes[1]);
			}
			if(more) {
				page++;
			} else {
				//finel.innerHTML = '';
				page = 1;
			}			
			var params = {
				userId : userId,
				method : "download",
				pageSize: 10,
				pageIndex: page,
			};
			getDatawithToken('Document/GetUserDocuments', params, function(data) {
				hideLoading()
				var bottomTip = document.querySelectorAll('.mui-pull-bottom-tips');
				if(data.Type == 1) {
					if(data.Data && typeof(data.Data) == 'object') {
						hideErrForList('',idName);
						if(data.Data.length==0){
							if(!more){
								var errForList=showErrForList('暂无数据','','',idName);
								if(errForList){
									fragment.appendChild(showErrForList('暂无数据','','',idName))
								}
							}
						}
						if(data.Data.length <= 10) {
							document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'none';
						} else {							
							document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'block';
						}
						creatdownloadDocumentElement(data.Data, idName,more);
					} else {
						document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'none';
						if(!more){
							var errForList=showErrForList(data.Data,'','',idName);
							if(errForList){
								fragment.appendChild(showErrForList(data.Data,'','',idName))
							}
						}
					}
				} else if(data.Type == 0) {
					//登录失败
					mui.toast("请登录后再进行操作");
					login();
					return;
				} else {
					//逻辑错误
					var errForList=showErrForList(data.Data,'','',idName);
					if(errForList){
						fragment.appendChild(showErrForList(data.Data,'','',idName))
					}
					mui.toast(data.Data);
					return;
				}
			}, function(err) {
				setErr('','90px')
			})
		}
		function favoriteDocument(more) {
//			if(!more) {
//				showLoading('', '', '#FFFFFF', '90px', '1');
//			}
			idName = selel[0].href.substring(selel[0].href.lastIndexOf("#") + 1, selel[0].href.length);
			var fragment = document.getElementById(idName);
			var cfragment = document.getElementById("refreshContainer2")
			var finel = cfragment.firstElementChild.querySelector('.mui-table-view');
			if(finel.querySelector('.mui-loading')) {
				finel.removeChild(finel.childNodes[1]);
			}
			if(more) {
				page++;
			} else {
				//finel.innerHTML = '';
				page = 1;
			}			
			var params = {
				userId : userId,
				method : "favorite",
				pageSize: 10,
				pageIndex: page,
			};
			getDatawithToken('Document/GetUserDocuments', params, function(data) {
				hideLoading()
				var bottomTip = document.querySelectorAll('.mui-pull-bottom-tips');
				if(data.Type == 1) {
					if(data.Data && typeof(data.Data) == 'object') {
						hideErrForList('',idName);
						if(data.Data.length <= 10) {
							document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'none';
						} else {							
							document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'block';
						}
						creatfavoritedocumentElement(data.Data, idName,more);
					} else {
						document.getElementById(idName).querySelector('.mui-pull-bottom-tips').style.display = 'none';
						if(!more){
							var errForList=showErrForList('暂无数据','','',idName);
							if(errForList){
								fragment.appendChild(showErrForList('暂无数据','','',idName))
							}
						}
					}
				} else if(data.Type == 0) {
					//登录失败
					mui.toast("请登录后再进行操作");
					login();
					return;
				} else {
					//逻辑错误
					var errForList=showErrForList(data.Data,'','',idName);
					if(errForList){
						fragment.appendChild(showErrForList(data.Data,'','',idName))
					}
					mui.toast(data.Data);
					return;
				}
			}, function(err) {
				setErr('','90px')
			})
		}
		function changeTab(index) {
			var gallery = mui('#sliderSegmentedControl');
			var gallerys = mui('#slider');
			gallery.scroll().gotoPage(index);
			gallerys.slider().gotoItem(index);
			if(index == 1) {
				downloadDocument(false)
				mui('#refreshContainer1').scroll().scrollTo(0,0);
			}
			if(index == 2) {
				favoriteDocument(false)
				mui('#refreshContainer2').scroll().scrollTo(0,0);
			}
			if(index == 0) {
				uploadedDocument(false)
				mui('#refreshContainer').scroll().scrollTo(0,0);
			}
		}
		mui.init({
			gestureConfig: {
				swipeBack: true //启用右滑关闭功能
			},
		});								
	</script>
</html>